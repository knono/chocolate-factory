<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailscale VPN Analytics - Chocolate Factory</title>
    <link rel="stylesheet" href="/static/css/vpn-dashboard.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê Tailscale VPN Analytics</h1>
            <p class="subtitle">Monitorizaci√≥n en tiempo real de accesos y dispositivos Tailnet</p>
            <div class="header-actions">
                <button onclick="refreshDashboard()" class="btn-refresh">üîÑ Actualizar</button>
                <a href="/static/index.html" class="btn-link">‚Üê Dashboard Principal</a>
            </div>
        </header>

        <!-- Quota Status Card -->
        <section class="card quota-card" id="quota-card">
            <h2>üìä Estado de Cuota (Free Tier)</h2>
            <div class="quota-content">
                <div class="quota-gauge">
                    <div class="gauge-circle" id="quota-gauge">
                        <div class="gauge-text">
                            <span class="quota-number" id="quota-number">0/3</span>
                            <span class="quota-label">usuarios</span>
                        </div>
                    </div>
                </div>
                <div class="quota-details">
                    <div class="quota-stat">
                        <span class="stat-label">Disponible:</span>
                        <span class="stat-value" id="quota-available">3</span>
                    </div>
                    <div class="quota-stat">
                        <span class="stat-label">Porcentaje:</span>
                        <span class="stat-value" id="quota-percentage">0%</span>
                    </div>
                    <div class="quota-alert" id="quota-alert" style="display:none;">
                        <strong>‚ö†Ô∏è Alerta:</strong> <span id="quota-alert-text"></span>
                    </div>
                </div>
            </div>
            <div class="external-users" id="external-users-list"></div>
        </section>

        <!-- Devices Grid -->
        <section class="devices-grid">
            <!-- Own Nodes Card -->
            <div class="card devices-card">
                <h2>üíª Mis Dispositivos</h2>
                <div class="device-count" id="own-count">0 dispositivos</div>
                <div class="devices-list" id="own-devices"></div>
            </div>

            <!-- Shared Nodes Card -->
            <div class="card devices-card">
                <h2>ü§ù Nodos Compartidos</h2>
                <div class="device-count" id="shared-count">0 dispositivos</div>
                <div class="devices-list" id="shared-devices"></div>
            </div>

            <!-- External Users Card -->
            <div class="card devices-card">
                <h2>üë• Usuarios Externos</h2>
                <div class="device-count" id="external-count">0 dispositivos</div>
                <div class="devices-list" id="external-devices"></div>
            </div>
        </section>

        <!-- Access Logs Card -->
        <section class="card logs-card">
            <h2>üìù Accesos Recientes (√öltimas 24h)</h2>
            <div class="logs-controls">
                <select id="hours-select" onchange="changeTimeRange()">
                    <option value="24">√öltimas 24 horas</option>
                    <option value="48">√öltimas 48 horas</option>
                    <option value="168">√öltima semana</option>
                </select>
            </div>
            <div class="logs-summary" id="logs-summary">
                <div class="summary-stat">
                    <span class="stat-number" id="total-requests">0</span>
                    <span class="stat-label">Accesos totales</span>
                </div>
                <div class="summary-stat">
                    <span class="stat-number" id="unique-users">0</span>
                    <span class="stat-label">Usuarios √∫nicos</span>
                </div>
                <div class="summary-stat">
                    <span class="stat-number" id="unique-devices">0</span>
                    <span class="stat-label">Dispositivos √∫nicos</span>
                </div>
            </div>
            <div class="logs-table-container">
                <table class="logs-table" id="logs-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Usuario</th>
                            <th>Dispositivo</th>
                            <th>Endpoint</th>
                            <th>M√©todo</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="logs-tbody"></tbody>
                </table>
            </div>
        </section>

        <footer>
            <p>√öltima actualizaci√≥n: <span id="last-update">--</span></p>
            <p class="footer-note">CLI nativo Tailscale | Auto-refresh cada 30s</p>
        </footer>
    </div>

    <script src="/static/js/vpn-dashboard.js"></script>
</body>
</html>
