<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chocolate Factory - Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/predictive-dashboard.css">
    <link rel="stylesheet" href="css/chatbot.css">
</head>
<body>
    <div class="header">
        <h1>
            <span>🍫</span>
            Chocolate Factory - Linares, Andalucía
        </h1>
        <p>Dashboard - ML con Datos Históricos (SIAR 88k + REE 42k)</p>
    </div>

    <div class="container">
        <div class="status-bar">
            <div>
                <span id="status" class="status-badge status-warning">🔄 Conectando...</span>
            </div>
            <div>
                <span>Última actualización: <strong id="last-update">--</strong></span>
            </div>
            <div>
                <button class="refresh-btn" onclick="loadData()">🔄 Actualizar</button>
            </div>
        </div>

        <!-- Dashboard Principal Unificado (Sprint 09: Fusión Energía + Clima + Sistema) -->
        <div class="card" style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a8c 100%); color: white;">
            <div class="card-header">
                <span class="card-icon">📊</span>
                <span class="card-title" style="color: white;">Dashboard Principal - Estado Actual</span>
            </div>

            <div class="grid grid-3" style="gap: 1.5rem; margin-top: 1.5rem;">
                <!-- Precio Energía -->
                <div style="background: rgba(255,255,255,0.1); padding: 1.25rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <span style="font-size: 1.5rem;">⚡</span>
                        <strong style="font-size: 1rem;">Precio Energía</strong>
                    </div>
                    <div style="font-size: 2.2rem; font-weight: bold; color: #fbbf24; margin-bottom: 0.5rem;" id="energy-price">--</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.75rem;">€/kWh</div>
                    <div id="energy-trend" style="font-size: 0.85rem; padding: 0.25rem 0.5rem; background: rgba(255,255,255,0.15); border-radius: 4px; display: inline-block;">--</div>
                    <div style="margin-top: 1rem; font-size: 0.8rem; opacity: 0.8; line-height: 1.4;">
                        <div>MWh: <span id="energy-mwh">--</span></div>
                        <div>Fecha: <span id="energy-datetime">--</span></div>
                    </div>
                </div>

                <!-- Condiciones Climáticas -->
                <div style="background: rgba(255,255,255,0.1); padding: 1.25rem; border-radius: 8px; border-left: 4px solid #10b981;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <span style="font-size: 1.5rem;">🌡️</span>
                        <strong style="font-size: 1rem;">Condiciones Clima</strong>
                    </div>
                    <div style="font-size: 2.2rem; font-weight: bold; color: #34d399; margin-bottom: 0.5rem;" id="temperature">--</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.75rem;">°C</div>
                    <div style="font-size: 0.85rem; line-height: 1.6; opacity: 0.9;">
                        <div>💧 Humedad: <span id="humidity">--%</span></div>
                        <div>🌫️ Presión: <span id="pressure">-- hPa</span></div>
                        <div>🎯 Confort: <span id="comfort-index">--</span></div>
                    </div>
                </div>

                <!-- Sistema & Fábrica -->
                <div style="background: rgba(255,255,255,0.1); padding: 1.25rem; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <span style="font-size: 1.5rem;">🏭</span>
                        <strong style="font-size: 1rem;">Sistema & Fábrica</strong>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <div style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 0.25rem;">Estado</div>
                        <div id="production-status" style="font-size: 1.1rem; font-weight: 600;">🟢 Operativo</div>
                        <div style="font-size: 0.85rem; margin-top: 0.25rem;">Eficiencia: <span id="factory-efficiency" style="color: #34d399; font-weight: 600;">85%</span></div>
                    </div>

                    <div style="padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.2);">
                        <div style="font-size: 0.8rem; opacity: 0.85; line-height: 1.6;">
                            <div style="margin-bottom: 0.25rem;"><strong>📍 Linares, Andalucía</strong></div>
                            <div style="opacity: 0.9;">⛰️ Altitud: 515m</div>
                            <div style="opacity: 0.9;">📐 38.151°N, -3.629°W</div>
                            <div style="margin-top: 0.5rem; opacity: 0.9;">🌡️ AEMET 5279X + OpenWeather</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HOURLY OPTIMIZATION -->
        <div class="card" style="margin-top: 2rem; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white;">
            <div class="card-header">
                <span class="card-icon">🎯</span>
                <span class="card-title" style="color: white;">Plan Optimizado 24h</span>
            </div>

            <!-- Optimization Summary -->
            <div class="grid grid-3" style="gap: 1rem; margin-top: 1.5rem;">
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">💰 Ahorro Estimado</div>
                    <div style="font-size: 1.8rem; font-weight: bold;" id="opt-savings-eur">-- €</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;"><span id="opt-savings-percent">--%</span> vs baseline</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">📦 Batches Programados</div>
                    <div style="font-size: 1.8rem; font-weight: bold;" id="opt-num-batches">--</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;"><span id="opt-target-kg">--</span> kg objetivo</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">⚡ Costo Energético</div>
                    <div style="font-size: 1.8rem; font-weight: bold;" id="opt-total-cost">-- €</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;"><span id="opt-total-energy">--</span> kWh</div>
                </div>
            </div>

            <!-- Batches Timeline -->
            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                <h4 style="color: white; margin-bottom: 1rem; font-size: 1rem;">📅 Timeline Producción Optimizada</h4>
                <div id="opt-batches-timeline" style="max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; padding: 2rem; opacity: 0.7;">
                        ⏳ Cargando plan optimizado...
                    </div>
                </div>
            </div>

            <!-- Hourly Timeline 24h (NEW) -->
            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                <h4 style="color: white; margin-bottom: 1rem; font-size: 1rem;">🕐 Vista Horaria 24h - Precio + Periodo + Producción</h4>
                <div id="hourly-timeline-container" style="max-height: 500px; overflow-y: auto; overflow-x: auto;">
                    <div style="text-align: center; padding: 2rem; opacity: 0.7;">
                        ⏳ Cargando timeline horaria...
                    </div>
                </div>
            </div>

            <!-- Optimization Recommendations -->
            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px; border-left: 4px solid #4CAF50;">
                <div style="font-weight: bold; margin-bottom: 0.5rem;">💡 Recomendaciones de Optimización:</div>
                <div id="opt-recommendations" style="font-size: 0.9rem; line-height: 1.6;">
                    <div>⏳ Calculando recomendaciones...</div>
                </div>
            </div>

            <!-- Baseline Comparison -->
            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                <h4 style="color: white; margin-bottom: 1rem; font-size: 0.95rem; opacity: 0.9;">📊 Comparativa Baseline vs Optimizado</h4>
                <div class="grid grid-2" style="gap: 1rem; font-size: 0.85rem;">
                    <div>
                        <strong style="color: #FF9800;">📍 Baseline (horario fijo 08-16h):</strong>
                        <div style="margin-top: 0.5rem; line-height: 1.6; opacity: 0.9;">
                            <div>Costo: <span id="baseline-cost">-- €</span></div>
                            <div>Energía: <span id="baseline-energy">-- kWh</span></div>
                            <div>Precio promedio: <span id="baseline-avg-price">-- €/kWh</span></div>
                        </div>
                    </div>
                    <div>
                        <strong style="color: #4CAF50;">✨ Optimizado (precio + clima):</strong>
                        <div style="margin-top: 0.5rem; line-height: 1.6; opacity: 0.9;">
                            <div>Costo: <span id="optimized-cost">-- €</span></div>
                            <div>Energía: <span id="optimized-energy">-- kWh</span></div>
                            <div>Precio promedio: <span id="optimized-avg-price">-- €/kWh</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Refresh Button -->
            <div style="margin-top: 1.5rem; text-align: center;">
                <button onclick="loadOptimizationPlan()" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.4); color: white; padding: 0.75rem 2rem; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: bold; transition: all 0.3s;">
                    🔄 Recalcular Plan Optimizado
                </button>
            </div>
        </div>

        <!-- DASHBOARD PREDICTIVO UNIFICADO (Sprint 09 + Pronóstico Semanal) -->
        <div class="card heatmap-card" style="margin-top: 2rem; font-size: 0.85rem;">
            <div class="card-header">
                <span class="card-icon">📊</span>
                <span class="card-title">Dashboard Predictivo Completo - Análisis y Pronósticos</span>
            </div>
            <div class="heatmap-content">
                <div class="heatmap-legend" id="heatmap-legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #4CAF50;"></span>
                        <span>🟢 Bajo (≤0.10 €/kWh)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #FF9800;"></span>
                        <span>🟡 Medio (0.10-0.20 €/kWh)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #F44336;"></span>
                        <span>🔴 Alto (>0.20 €/kWh)</span>
                    </div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Se llena dinámicamente con JavaScript -->
                </div>
                <div class="heatmap-summary" id="heatmap-summary">
                    <div class="summary-item">
                        <span class="summary-label">Días Óptimos:</span>
                        <span id="optimal-days">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Precio Promedio:</span>
                        <span id="avg-price">0.000 €/kWh</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Rango:</span>
                        <span id="price-range">0.00 - 0.00 €/kWh</span>
                    </div>
                </div>
            </div>

            <!-- Métricas Históricas Integradas -->
            <div class="grid grid-3" style="gap: 1.5rem; margin-top: 1.5rem; padding: 1.5rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                <div class="analytics-section">
                    <h4 style="color: #66BB6A; margin-bottom: 1rem; font-size: 0.9rem;">📊 Históricos 2024</h4>
                    <div class="analytics-metric" style="margin-bottom: 0.5rem;">
                        <span class="metric-label" style="font-size: 0.8rem; color: #333;">Costo Total:</span>
                        <span class="metric-value" style="color: #333; font-size: 0.9rem;" id="total-cost">-- €</span>
                    </div>
                    <div class="analytics-metric" style="margin-bottom: 0.5rem;">
                        <span class="metric-label" style="font-size: 0.8rem; color: #333;">Min/Max:</span>
                        <span class="metric-value" style="color: #333; font-size: 0.9rem;" id="min-max-price">--/-- €/kWh</span>
                    </div>
                </div>

                <div class="analytics-section">
                    <h4 style="color: #2196F3; margin-bottom: 1rem; font-size: 0.9rem;">🎯 Potencial</h4>
                    <div class="analytics-metric" style="margin-bottom: 0.5rem;">
                        <span class="metric-label" style="font-size: 0.8rem; color: #333;">Ahorro Anual:</span>
                        <span class="metric-value" style="color: #333; font-size: 0.9rem;" id="annual-projection">-- €</span>
                    </div>
                    <div class="analytics-metric" style="margin-bottom: 0.5rem;">
                        <span class="metric-label" style="font-size: 0.8rem; color: #333;">Horas Óptimas:</span>
                        <span class="metric-value" style="color: #333; font-size: 0.9rem;" id="optimal-hours">-- h</span>
                    </div>
                </div>

                <div class="analytics-section">
                    <h4 style="color: #FF9800; margin-bottom: 1rem; font-size: 0.9rem;">💡 Recomendaciones</h4>
                    <div id="unified-optimization-recommendations" style="font-size: 0.8rem; line-height: 1.4; color: #333;">
                        <!-- Recomendaciones unificadas -->
                    </div>
                </div>
            </div>

            <!-- SPRINT 09: VENTANAS ÓPTIMAS -->
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid rgba(0,0,0,0.1);">
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.1rem; color: #10b981; margin-bottom: 0.5rem;">🟢 Próximas Ventanas Óptimas (7 Días)</h3>
                    <p style="font-size: 0.75rem; color: #666; margin: 0;">Basado en predicciones Prophet ML + periodos tarifarios</p>
                </div>
                <div id="optimal-windows-container">
                    <div style="text-align: center; padding: 1.5rem; opacity: 0.5; font-size: 0.8rem;">
                        ⏳ Cargando ventanas óptimas...
                    </div>
                </div>
            </div>

            <!-- SPRINT 09: ANÁLISIS & TRACKING -->
            <div class="grid grid-2" style="margin-top: 2rem; gap: 1.5rem;">
                <!-- REE Deviation Analysis -->
                <div style="background: rgba(59, 130, 246, 0.05); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <h4 style="font-size: 1rem; color: #3b82f6; margin-bottom: 1rem;">📊 REE D-1 vs REAL (Últimas 24h)</h4>
                    <div id="ree-deviation-container">
                        <div style="text-align: center; padding: 1.5rem; opacity: 0.5; font-size: 0.8rem;">
                            ⏳ Cargando análisis REE...
                        </div>
                    </div>
                </div>

                <!-- Savings Tracking -->
                <div style="background: rgba(139, 92, 246, 0.05); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                    <h4 style="font-size: 1rem; color: #8b5cf6; margin-bottom: 1rem;">💰 Ahorro Energético Semanal</h4>
                    <div id="savings-tracking-container">
                        <div style="text-align: center; padding: 1.5rem; opacity: 0.5; font-size: 0.8rem;">
                            ⏳ Cargando tracking ahorros...
                        </div>
                    </div>
                </div>
            </div>

            <!-- SPRINT 09: ALERTAS PREDICTIVAS -->
            <div style="margin-top: 2rem; background: rgba(245, 158, 11, 0.05); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <h4 style="font-size: 1rem; color: #f59e0b; margin-bottom: 1rem;">⚠️ Alertas Predictivas (Próximas 24-48h)</h4>
                <div id="predictive-alerts-container">
                    <div style="text-align: center; padding: 1.5rem; opacity: 0.5; font-size: 0.8rem;">
                        ⏳ Cargando alertas predictivas...
                    </div>
                </div>
            </div>

        </div>

        <!-- SIAR Historical Analysis -->
        <div class="card" style="margin-top: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <div class="card-header">
                <span class="card-icon">📊</span>
                <span class="card-title">Análisis Histórico SIAR (2000-2025)</span>
            </div>

            <!-- SIAR Summary Stats -->
            <div class="grid grid-3" style="gap: 1rem; margin-top: 1.5rem;">
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">📈 Registros Totales</div>
                    <div style="font-size: 1.8rem; font-weight: bold;" id="siar-total-records">--</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;" id="siar-date-range">--</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">🌡️ Correlación Temp</div>
                    <div style="font-size: 1.8rem; font-weight: bold;" id="siar-temp-correlation">--</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">R² vs Producción</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">💧 Correlación Humedad</div>
                    <div style="font-size: 1.8rem; font-weight: bold;" id="siar-humidity-correlation">--</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">R² vs Producción</div>
                </div>
            </div>

            <!-- Seasonal Patterns -->
            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                <h4 style="color: white; margin-bottom: 1rem; font-size: 1rem;">📅 Patrones Estacionales</h4>
                <div class="grid grid-2" style="gap: 1rem;">
                    <div>
                        <div style="font-size: 0.85rem; margin-bottom: 0.5rem;">🟢 Mejor Mes:</div>
                        <div style="font-size: 1.1rem; font-weight: bold;" id="siar-best-month">--</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;" id="siar-best-month-score">--</div>
                    </div>
                    <div>
                        <div style="font-size: 0.85rem; margin-bottom: 0.5rem;">🔴 Peor Mes:</div>
                        <div style="font-size: 1.1rem; font-weight: bold;" id="siar-worst-month">--</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;" id="siar-worst-month-score">--</div>
                    </div>
                </div>
            </div>

            <!-- Critical Thresholds -->
            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                <h4 style="color: white; margin-bottom: 1rem; font-size: 1rem;">⚠️ Umbrales Críticos (Percentiles Históricos)</h4>
                <div class="grid grid-2" style="gap: 1rem; font-size: 0.9rem;">
                    <div>
                        <strong>🌡️ Temperatura:</strong>
                        <div style="margin-top: 0.5rem; line-height: 1.6;">
                            <div>P90: <span id="siar-temp-p90">--</span>°C</div>
                            <div>P95: <span id="siar-temp-p95">--</span>°C</div>
                            <div>P99: <span id="siar-temp-p99">--</span>°C</div>
                        </div>
                    </div>
                    <div>
                        <strong>💧 Humedad:</strong>
                        <div style="margin-top: 0.5rem; line-height: 1.6;">
                            <div>P90: <span id="siar-humidity-p90">--</span>%</div>
                            <div>P95: <span id="siar-humidity-p95">--</span>%</div>
                            <div>P99: <span id="siar-humidity-p99">--</span>%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIAR Insights -->
            <div style="margin-top: 1.5rem; background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px; border-left: 4px solid #FFD700;">
                <div style="font-weight: bold; margin-bottom: 0.5rem;">💡 Insights Históricos:</div>
                <div id="siar-insights" style="font-size: 0.9rem; line-height: 1.6;">
                    <div>⏳ Cargando análisis histórico...</div>
                </div>
            </div>
        </div>

        <!-- SPRINT 11: CHATBOT BI CONVERSACIONAL -->
        <div class="card" style="margin-top: 2rem; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white;">
            <div class="card-header">
                <span class="card-icon">🤖</span>
                <span class="card-title" style="color: white;">Asistente BI Conversacional - Claude Haiku</span>
            </div>

            <!-- Chat Messages Container -->
            <div id="chatMessagesContainer" style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 1.5rem; margin-top: 1.5rem; max-height: 400px; overflow-y: auto;">
                <!-- Welcome Message -->
                <div class="chat-message assistant-message">
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                        <div style="font-size: 2rem; flex-shrink: 0;">🤖</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; flex: 1;">
                            <strong style="display: block; margin-bottom: 0.5rem;">¡Hola! Soy tu asistente BI</strong>
                            <div style="font-size: 0.9rem; line-height: 1.6; opacity: 0.95;">
                                Puedo ayudarte con:
                                <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                                    <li>⚡ Precios energéticos y predicciones</li>
                                    <li>🏭 Recomendaciones de producción</li>
                                    <li>🌡️ Condiciones climáticas</li>
                                    <li>💰 Análisis de ahorros</li>
                                    <li>🚨 Alertas del sistema</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Questions -->
            <div style="margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.75rem;">
                <button onclick="askQuickQuestion('¿Cuándo debo producir hoy?')" class="chatbot-quick-btn">
                    🏭 ¿Cuándo producir?
                </button>
                <button onclick="askQuickQuestion('¿Cuál es el precio actual?')" class="chatbot-quick-btn">
                    ⚡ Precio actual
                </button>
                <button onclick="askQuickQuestion('¿Hay alertas?')" class="chatbot-quick-btn">
                    🚨 Ver alertas
                </button>
                <button onclick="askQuickQuestion('Ahorro esta semana')" class="chatbot-quick-btn">
                    💰 Ahorro semanal
                </button>
            </div>

            <!-- Input Container -->
            <div style="margin-top: 1.5rem; display: flex; gap: 0.75rem;">
                <input
                    type="text"
                    id="chatbotInput"
                    placeholder="Escribe tu pregunta..."
                    maxlength="500"
                    autocomplete="off"
                    style="flex: 1; padding: 1rem; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; font-size: 1rem;"
                    onkeypress="if(event.key==='Enter') sendChatbotMessage()"
                >
                <button
                    id="chatbotSendBtn"
                    onclick="sendChatbotMessage()"
                    style="padding: 1rem 2rem; border-radius: 8px; border: none; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s;"
                    onmouseover="this.style.transform='scale(1.05)'"
                    onmouseout="this.style.transform='scale(1)'"
                >
                    <span id="chatbotSendIcon">📤</span>
                    <span id="chatbotLoadingIcon" style="display: none;">⏳</span>
                </button>
            </div>

            <!-- Stats Footer -->
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; opacity: 0.7; text-align: center;">
                <span id="chatbotStats">Powered by Claude Haiku API</span>
            </div>
        </div>

    </div>

    <div class="footer">
        Chocolate Factory - Linares, Andalucía | Dashboard v0.45.0 (Sprint 11 - Chatbot BI) |
        Powered by FastAPI + ML (131k+ Historical Records) + Prophet Forecasting + Claude Haiku
    </div>

    <!-- Core Scripts -->
    <script src="js/utils/api.js"></script>
    <script src="js/utils/formatters.js"></script>
    <script src="js/services/dashboard-service.js"></script>

    <!-- Sprint 09 Components -->
    <script src="js/components/optimal-windows.js"></script>
    <script src="js/components/ree-deviation.js"></script>
    <script src="js/components/predictive-alerts.js"></script>
    <script src="js/components/savings-tracking.js"></script>

    <!-- Sprint 11: Chatbot BI -->
    <script src="js/chatbot.js"></script>

    <!-- Main Dashboard (legacy app.js removed - using only dashboard.js) -->
    <script src="js/dashboard.js?v=0.43.0"></script>
</body>
</html>
